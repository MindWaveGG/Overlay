<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="refresh" content="5">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBS Donut Bar Graphs</title>
    <style>
        canvas {
            background-color: transparent;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas"></canvas>
    <script>
        const targetDate = new Date("2026-02-01T23:59:59").getTime();

        let followerCurrent = 394, followerGoal = 850;
        let subCurrent = 3, subGoal = 20;
        let donationCurrent = 450, donationGoal = 500;
        let bitsCurrent = 600, bitsGoal = 1000;

        function getTimeRemaining() {
            const now = new Date().getTime();
            const timeLeft = targetDate - now;

            return {
                countdownDays: Math.floor(timeLeft / (1000 * 60 * 60 * 24)),
                countdownHours: Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
                countdownMinutes: Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)),
                countdownSeconds: Math.floor((timeLeft % (1000 * 60)) / 1000),
                percentage: Math.max(0, Math.min(1, 1 - timeLeft / (targetDate - new Date("2025-02-18T00:00:00").getTime())))
            };
        }

        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        const canvasSize = 2200;
        canvas.width = canvasSize;
        canvas.height = canvasSize;
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        const donutWidth = 40;
        const donutSpacing = 15;
        const cameraRadius = 670;
        const baseRadius = cameraRadius + donutSpacing + donutWidth;

        const cameraImage = new Image();
        cameraImage.src = 'https://static-cdn.jtvnw.net/jtv_user_pictures/4ae8547d-3e84-47bd-a024-ba09885f1bbe-profile_image-300x300.png';

        function drawCameraCircle(x, y, radius, transparency) {
            ctx.save();
            ctx.globalAlpha = transparency;
            ctx.drawImage(cameraImage, x - radius, y - radius, radius * 2, radius * 2);
            ctx.restore();
        }

        function drawDonut(x, y, radius, width, percentage, color, lineColor) {
            const endAngle = Math.PI * 2 * percentage - Math.PI / 2;
            if (percentage > 0) {
                ctx.beginPath();
                ctx.arc(x, y, radius, -Math.PI / 2, endAngle);
                ctx.lineWidth = width;
                ctx.strokeStyle = color;
                ctx.stroke();
                
                ctx.beginPath();
                ctx.arc(x, y, radius + width / 2, -Math.PI / 2, endAngle);
                ctx.lineWidth = 5;
		ctx.lineColor = lineColor;
                ctx.strokeStyle = 'black';
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(x, y, radius - width / 2, -Math.PI / 2, endAngle);
                ctx.lineWidth = 5;
		ctx.lineColor = lineColor;
                ctx.strokeStyle = 'black';
                ctx.stroke();
            }
        }

        function drawLabelWithLine(label, x, y, radius, percentage, labelIndex, totalLabels, textColor, lineColor, borderColor) {
            const padding = 10;
            const fontSize = 60;
            ctx.font = `bold ${fontSize}px Arial`;
            ctx.fillStyle = textColor;

            const textWidth = ctx.measureText(label).width;
            const labelWidth = textWidth + padding * 2;
            const labelHeight = fontSize + padding * 2;

            const reversedIndex = totalLabels - labelIndex - 1;
            const labelX = 100;
            const labelY = 100 + reversedIndex * (labelHeight + 10);

            const angle = (-Math.PI / 2) + (Math.PI * 2 * percentage);
            const startX = x + radius * Math.cos(angle);
            const startY = y + radius * Math.sin(angle);

            ctx.fillStyle = borderColor;
            ctx.fillRect(labelX, labelY, labelWidth, labelHeight);
            ctx.strokeStyle = borderColor;
            ctx.lineWidth = 5;
            ctx.strokeRect(labelX, labelY, labelWidth, labelHeight);
	    ctx.stroke();
		
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(labelX + labelWidth, labelY + labelHeight / 2);
            ctx.strokeStyle = lineColor;
            ctx.lineWidth = 5;
            ctx.stroke();

            ctx.fillStyle = textColor;
            ctx.textAlign = "left";
            ctx.fillText(label, labelX + padding, labelY + fontSize + padding / 2);
        }

        function drawAll() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawCameraCircle(centerX, centerY, cameraRadius + 20, 0.1);

            const { countdownDays, countdownHours, countdownMinutes, countdownSeconds, percentage } = getTimeRemaining();
            const countdownText = `Retires In: ${countdownDays}d ${countdownHours}h ${countdownMinutes}m ${countdownSeconds}s`;

            let data = [
                { label: countdownText, percentage: percentage, color: 'red', borderColor: 'black' },
                { label: `Followers: ${followerCurrent}/${followerGoal}`, percentage: followerCurrent / followerGoal, color: 'red', borderColor: 'black' },
                { label: `Subs: ${subCurrent}/${subGoal}`, percentage: subCurrent / subGoal, color: 'red', borderColor: 'black' },
                { label: `Donations: $${donationCurrent}/$${donationGoal}`, percentage: donationCurrent / donationGoal, color: 'red', borderColor: 'black' },
                { label: `Bits: ${bitsCurrent}/${bitsGoal}`, percentage: bitsCurrent / bitsGoal, color: 'red', borderColor: 'black' }
            ];

            data.sort((a, b) => b.percentage - a.percentage);

            data.forEach((item, index) => {
                drawDonut(centerX, centerY, baseRadius + index * (donutWidth + donutSpacing), donutWidth, item.percentage, item.color);
                drawLabelWithLine(item.label, centerX, centerY, baseRadius + index * (donutWidth + donutSpacing), item.percentage, index, data.length, 'white', 'red', 'black');
            });

            requestAnimationFrame(drawAll);
        }

        cameraImage.onload = function() {
            drawAll();
        };
    </script>
</body>
</html>
