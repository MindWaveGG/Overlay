<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Timer and Goal Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<style>
body { font-family: Arial; margin:0; padding:20px; }
</style>
</head>

<body>

<canvas id="myCanvas"></canvas>

<script>
/* =========================
   CANVAS SETUP
========================= */
const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');

canvas.width = 2200;
canvas.height = 2200;

const centerX = canvas.width / 2;
const centerY = canvas.height / 2;

const donutWidth = 40;
const donutSpacing = 15;
const cameraRadius = 670;
const baseRadius = cameraRadius + donutSpacing + donutWidth;

/* =========================
   IMAGE
========================= */
const cameraImage = new Image();
cameraImage.src =
'https://static-cdn.jtvnw.net/jtv_user_pictures/4ae8547d-3e84-47bd-a024-ba09885f1bbe-profile_image-300x300.png';

/* =========================
   DATA STATE
========================= */
let followerCurrent=0,followerGoal=1;
let subCurrent=0,subGoal=1;
let bitsCurrent=0,bitsGoal=1;
let donationCurrent=0,donationGoal=1;
let startTime,endTime,targetDate;

/* =========================
   CAMERA
========================= */
function drawCameraCircle(x,y,r,a){
 ctx.save();
 ctx.globalAlpha=a;
 ctx.beginPath();
 ctx.arc(x,y,r,0,Math.PI*2);
 ctx.clip();
 ctx.drawImage(cameraImage,x-r,y-r,r*2,r*2);
 ctx.restore();
 ctx.beginPath();
 ctx.arc(x,y,r,0,Math.PI*2);
 ctx.lineWidth=8;
 ctx.strokeStyle='#FF0000CC';
 ctx.stroke();
}

/* =========================
   DONUT
========================= */
function drawDonut(x,y,r,w,p,color){
 if(p<=0) return;
 const end=(-Math.PI/2)+(Math.PI*2*p);
 ctx.beginPath();
 ctx.arc(x,y,r,-Math.PI/2,end);
 ctx.lineWidth=w;
 ctx.strokeStyle=color;
 ctx.stroke();
}

/* =========================
   LABEL LAYOUT (NO DRAW)
========================= */
function layoutLabels(data){
 const fontSize=80;
 const padding=10;
 ctx.font=`bold ${fontSize}px Arial`;

 return data.map((d,i)=>{
   const w=ctx.measureText(d.label).width+padding*2;
   const h=fontSize+padding*2;
   const ri=data.length-i-1;
   return {
     ...d,
     fontSize,padding,width:w,height:h,
     x:100,
     y:100+ri*(h+10)
   };
 });
}

/* =========================
   LEADER LINES
========================= */
function drawLeaderLine(item,radius){
 const a=(-Math.PI/2)+(Math.PI*2*item.percentage);
 const sx=centerX+radius*Math.cos(a);
 const sy=centerY+radius*Math.sin(a);
 const ex=item.x+item.width;
 const ey=item.y+item.height/2;

 ctx.beginPath();
 ctx.moveTo(sx,sy);
 ctx.lineTo(ex,ey);
 ctx.strokeStyle='orange';
 ctx.lineWidth=4;
 ctx.stroke();
}

/* =========================
   LABEL DRAW
========================= */
function drawLabel(item){
 ctx.strokeStyle='black';
 ctx.lineWidth=10;
 ctx.strokeRect(item.x,item.y,item.width,item.height);
 ctx.fillStyle='#0000007F';
 ctx.fillRect(item.x,item.y,item.width,item.height);
 ctx.fillStyle='white';
 ctx.font=`bold ${item.fontSize}px Arial`;
 ctx.fillText(
   item.label,
   item.x+item.padding,
   item.y+item.fontSize+item.padding/2
 );
}

/* =========================
   TIMER %
========================= */
function getTimeRemaining(){
 const now=Date.now();
 const t=targetDate-now;
 return {
   percentage:Math.max(0,Math.min(1,1-t/(targetDate-startTime)))
 };
}

/* =========================
   MAIN DRAW LOOP
========================= */
function drawAll(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 drawCameraCircle(centerX,centerY,cameraRadius+20,.13);

 const {percentage}=getTimeRemaining();
 const data=[
  {label:`Followers ${followerCurrent}/${followerGoal}`,percentage:followerCurrent/followerGoal,color:'#1D3ACD'},
  {label:`Subs ${subCurrent}/${subGoal}`,percentage:subCurrent/subGoal,color:'#1D3ACD'},
  {label:`Donations $${donationCurrent}/$${donationGoal}`,percentage:donationCurrent/donationGoal,color:'#1D3ACD'},
  {label:`Bits ${bitsCurrent}/${bitsGoal}`,percentage:bitsCurrent/bitsGoal,color:'#1D3ACD'},
  {label:`Timer`,percentage,color:'#1D3ACD'}
 ];

 data.sort((a,b)=>b.percentage-a.percentage);

 const layout=layoutLabels(data);

 // donuts
 layout.forEach((d,i)=>{
   drawDonut(centerX,centerY,
     baseRadius+i*(donutWidth+donutSpacing),
     donutWidth,d.percentage,d.color);
 });

 // leader lines
 layout.forEach((d,i)=>{
   drawLeaderLine(d,
     baseRadius+i*(donutWidth+donutSpacing));
 });

 // labels
 layout.forEach(drawLabel);

 requestAnimationFrame(drawAll);
}

/* =========================
   START
========================= */
cameraImage.onload=()=>{
 startTime=Date.now()-1000*60*60;
 targetDate=Date.now()+1000*60*60*24;
 drawAll();
};
</script>

</body>
</html>
